<<<<<<< HEAD
=======
// Esquema de base de datos para VolunNet
// Cumple con requerimientos de PostgreSQL y Redis para caché

>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
<<<<<<< HEAD
  id                    String                 @id @default(cuid())
  email                 String                 @unique
  password              String
  firstName             String
  lastName              String
  avatar                String?
  role                  Role                   @default(VOLUNTEER)
  verified              Boolean                @default(false)
  active                Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  emailVerified         Boolean                @default(false)
  emailVerifiedAt       DateTime?
  phoneVerified         Boolean                @default(false)
  phoneVerifiedAt       DateTime?
  emailVerificationCode EmailVerificationCode?
  eventApplications     EventApplication[]
  receivedMessages      Message[]              @relation("ReceivedMessages")
  sentMessages          Message[]              @relation("SentMessages")
  notifications         Notification[]
  organization          Organization?
  phoneVerificationCode PhoneVerificationCode?
  userVectors           UserVector[]
  volunteer             Volunteer?
=======
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  avatar    String?
  role      Role     @default(VOLUNTEER)
  verified  Boolean  @default(false)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones específicas por rol
  volunteer    Volunteer?
  organization Organization?

  // Relaciones generales
  notifications    Notification[]
  eventApplications EventApplication[]
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  userVectors      UserVector[]
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("users")
}

model Volunteer {
<<<<<<< HEAD
  id                 String         @id @default(cuid())
  userId             String         @unique
  skills             String[]
  interests          String[]
  bio                String?
  rating             Float          @default(0)
  hoursCompleted     Int            @default(0)
  eventsParticipated Int            @default(0)
  address            String?
  city               String?
  state              String?
  country            String?
  latitude           Float?
  longitude          Float?
  birthDate          DateTime?
  gender             String?
  languages          String[]
  experience         String[]
  socialLinks        String[]
  cvUrl              String?
  achievements       String[]
  verified           Boolean?
  references         String[]
  tagline            String?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  availability       Availability[]
  user               User           @relation(fields: [userId], references: [id], onDelete: Cascade)
=======
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  skills            String[]
  interests         String[]
  bio               String?
  rating            Float    @default(0)
  hoursCompleted    Int      @default(0)
  eventsParticipated Int     @default(0)
  
  // Ubicación
  address           String?
  city              String?
  state             String?
  country           String?
  latitude          Float?
  longitude         Float?
  
  // Disponibilidad
  availability      Availability[]

  // --- NUEVOS CAMPOS PARA MATCHING IA ---
  birthDate         DateTime?   // Fecha de nacimiento
  gender            String?     // Género (opcional)
  languages         String[]    // Idiomas
  experience        String[]    // Experiencia previa (puede ser JSON en el futuro)
  socialLinks       String[]    // Redes sociales
  cvUrl             String?     // Link o archivo de CV
  achievements      String[]    // Logros/badges
  verified          Boolean?    // Estado de verificación
  references        String[]    // Referencias
  tagline           String?     // Frase corta o lema personal
  // --- FIN NUEVOS CAMPOS ---

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("volunteers")
}

model Organization {
  id               String   @id @default(cuid())
  userId           String   @unique
<<<<<<< HEAD
=======
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb
  name             String
  description      String
  website          String?
  verified         Boolean  @default(false)
  eventsCreated    Int      @default(0)
  volunteersHelped Int      @default(0)
<<<<<<< HEAD
=======
  
  // Ubicación
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb
  address          String?
  city             String?
  state            String?
  country          String?
  latitude         Float?
  longitude        Float?
<<<<<<< HEAD
  contactEmail     String?
  contactPhone     String?
  socialLinks      String[]
  verificationDocs String[]
  preferences      String[]
  rating           Float    @default(0)
  tagline          String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  category         String[]
  events           Event[]
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
=======
  
  // Relaciones
  events           Event[]

  // --- NUEVOS CAMPOS PARA MATCHING IA ---
  category         String[]     // Sector/categoría de la organización
  contactEmail     String?     // Email alternativo
  contactPhone     String?     // Teléfono de contacto
  socialLinks      String[]    // Redes sociales
  verificationDocs String[]    // Documentos de verificación
  preferences      String[]    // Preferencias de voluntarios (skills, edad, etc.)
  rating           Float       @default(0) // Promedio de calificaciones
  tagline          String?     // Frase corta o lema de la organización
  // --- FIN NUEVOS CAMPOS ---

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("organizations")
}

model Event {
<<<<<<< HEAD
  id                String             @id @default(cuid())
  title             String
  description       String
  organizationId    String
  address           String
  city              String
  state             String
  country           String
  latitude          Float
  longitude         Float
  startDate         DateTime
  endDate           DateTime
  maxVolunteers     Int
  currentVolunteers Int                @default(0)
  skills            String[]
  categoryId        String
  status            EventStatus        @default(DRAFT)
  requirements      String[]
  benefits          String[]
  imageUrl          String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  applications      EventApplication[]
  category          EventCategory      @relation(fields: [categoryId], references: [id])
  organization      Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  messages          Message[]
=======
  id               String      @id @default(cuid())
  title            String
  description      String
  organizationId   String
  organization     Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  // Ubicación del evento
  address          String
  city             String
  state            String
  country          String
  latitude         Float
  longitude        Float
  
  // Fechas
  startDate        DateTime
  endDate          DateTime
  
  // Capacidad
  maxVolunteers    Int
  currentVolunteers Int        @default(0)
  
  // Categorización
  skills           String[]
  categoryId       String
  category         EventCategory @relation(fields: [categoryId], references: [id])
  
  // Estado
  status           EventStatus @default(DRAFT)
  
  // Detalles
  requirements     String[]
  benefits         String[]
  imageUrl         String?
  
  // Relaciones
  applications     EventApplication[]
  messages         Message[]
  
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("events")
}

model EventCategory {
<<<<<<< HEAD
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  icon        String
  color       String
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  events      Event[]
=======
  id          String  @id @default(cuid())
  name        String  @unique
  description String
  icon        String
  color       String
  active      Boolean @default(true)
  
  events      Event[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("event_categories")
}

model EventApplication {
  id          String            @id @default(cuid())
  eventId     String
<<<<<<< HEAD
  volunteerId String
  status      ApplicationStatus @default(PENDING)
  appliedAt   DateTime          @default(now())
  message     String?
  rating      Int?
  feedback    String?
  completedAt DateTime?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  event       Event             @relation(fields: [eventId], references: [id], onDelete: Cascade)
  volunteer   User              @relation(fields: [volunteerId], references: [id], onDelete: Cascade)
=======
  event       Event             @relation(fields: [eventId], references: [id], onDelete: Cascade)
  volunteerId String
  volunteer   User              @relation(fields: [volunteerId], references: [id], onDelete: Cascade)
  
  status      ApplicationStatus @default(PENDING)
  appliedAt   DateTime          @default(now())
  message     String?
  
  // Evaluación post-evento
  rating      Int?              // 1-5 stars
  feedback    String?
  completedAt DateTime?
  
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@unique([eventId, volunteerId])
  @@map("event_applications")
}

model Availability {
  id          String    @id @default(cuid())
  volunteerId String
<<<<<<< HEAD
  dayOfWeek   Int
  startTime   String
  endTime     String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  volunteer   Volunteer @relation(fields: [volunteerId], references: [id], onDelete: Cascade)
=======
  volunteer   Volunteer @relation(fields: [volunteerId], references: [id], onDelete: Cascade)
  
  dayOfWeek   Int       // 0-6 (Sunday-Saturday)
  startTime   String    // HH:MM format
  endTime     String    // HH:MM format
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("availability")
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
<<<<<<< HEAD
=======
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb
  title     String
  message   String
  type      NotificationType @default(INFO)
  read      Boolean          @default(false)
  actionUrl String?
<<<<<<< HEAD
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
=======
  
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("notifications")
}

model Message {
  id         String      @id @default(cuid())
  eventId    String?
<<<<<<< HEAD
  senderId   String
  receiverId String
  content    String
  read       Boolean     @default(false)
  type       MessageType @default(DIRECT)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  event      Event?      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  receiver   User        @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User        @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
=======
  event      Event?      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  senderId   String
  sender     User        @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiverId String
  receiver   User        @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  
  content    String
  read       Boolean     @default(false)
  type       MessageType @default(DIRECT)
  
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("messages")
}

<<<<<<< HEAD
model UserVector {
  id          String   @id @default(cuid())
  userId      String
  features    Float[]
  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
=======
// Modelos para Machine Learning
model UserVector {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  features    Float[]  // Vector de características para ML
  lastUpdated DateTime @default(now())
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb

  @@map("user_vectors")
}

model MLMetrics {
  id        String   @id @default(cuid())
<<<<<<< HEAD
  modelType String
=======
  modelType String   // 'knn', 'random_forest', etc.
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb
  precision Float
  recall    Float
  f1Score   Float
  accuracy  Float
<<<<<<< HEAD
=======
  
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb
  createdAt DateTime @default(now())

  @@map("ml_metrics")
}

<<<<<<< HEAD
model EmailVerificationCode {
  id        String   @id @default(cuid())
  userId    String   @unique
  email     String
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("email_verification_codes")
}

model PhoneVerificationCode {
  id        String   @id @default(cuid())
  userId    String   @unique
  phone     String
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("phone_verification_codes")
}

=======
// Enums
>>>>>>> ec1cbbc69193834a0a8ca358b8538c352ee8b7bb
enum Role {
  VOLUNTEER
  ORGANIZATION
  ADMIN
}

enum EventStatus {
  DRAFT
  PUBLISHED
  ONGOING
  COMPLETED
  CANCELLED
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  EVENT_UPDATE
  APPLICATION_UPDATE
  MESSAGE
}

enum MessageType {
  DIRECT
  EVENT_CHAT
  SYSTEM
}
